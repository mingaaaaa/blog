<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>electron的使用 | 前端杂货铺</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="搬砖仔的博客">
    
    <link rel="preload" href="/blog/assets/css/0.styles.f89f62fb.css" as="style"><link rel="preload" href="/blog/assets/js/app.c9971401.js" as="script"><link rel="preload" href="/blog/assets/js/3.622c1259.js" as="script"><link rel="preload" href="/blog/assets/js/1.525466ec.js" as="script"><link rel="preload" href="/blog/assets/js/11.ac1e60a5.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.84d2af98.js"><link rel="prefetch" href="/blog/assets/js/12.3344a763.js"><link rel="prefetch" href="/blog/assets/js/13.ba30de72.js"><link rel="prefetch" href="/blog/assets/js/14.4d94e462.js"><link rel="prefetch" href="/blog/assets/js/15.3b23bcf1.js"><link rel="prefetch" href="/blog/assets/js/16.c3e756d8.js"><link rel="prefetch" href="/blog/assets/js/17.82429d8f.js"><link rel="prefetch" href="/blog/assets/js/18.eabd7032.js"><link rel="prefetch" href="/blog/assets/js/19.e6c9e539.js"><link rel="prefetch" href="/blog/assets/js/20.b7b9cd49.js"><link rel="prefetch" href="/blog/assets/js/21.f660af26.js"><link rel="prefetch" href="/blog/assets/js/22.b43664db.js"><link rel="prefetch" href="/blog/assets/js/23.61336d47.js"><link rel="prefetch" href="/blog/assets/js/24.86e08025.js"><link rel="prefetch" href="/blog/assets/js/25.4dd8feff.js"><link rel="prefetch" href="/blog/assets/js/26.816fd53e.js"><link rel="prefetch" href="/blog/assets/js/27.5d915f8c.js"><link rel="prefetch" href="/blog/assets/js/28.e694529f.js"><link rel="prefetch" href="/blog/assets/js/29.c459d75a.js"><link rel="prefetch" href="/blog/assets/js/30.0fb11b29.js"><link rel="prefetch" href="/blog/assets/js/31.38e19e19.js"><link rel="prefetch" href="/blog/assets/js/32.3a36e206.js"><link rel="prefetch" href="/blog/assets/js/33.f1c7163d.js"><link rel="prefetch" href="/blog/assets/js/34.fc2af47a.js"><link rel="prefetch" href="/blog/assets/js/35.5394c0aa.js"><link rel="prefetch" href="/blog/assets/js/36.18d07c4f.js"><link rel="prefetch" href="/blog/assets/js/37.303abdb6.js"><link rel="prefetch" href="/blog/assets/js/38.58be5085.js"><link rel="prefetch" href="/blog/assets/js/39.7b1bd33a.js"><link rel="prefetch" href="/blog/assets/js/4.3f6b3c77.js"><link rel="prefetch" href="/blog/assets/js/40.9b8b502e.js"><link rel="prefetch" href="/blog/assets/js/41.a1966729.js"><link rel="prefetch" href="/blog/assets/js/42.fb4bb117.js"><link rel="prefetch" href="/blog/assets/js/5.5fc8180c.js"><link rel="prefetch" href="/blog/assets/js/6.45449909.js"><link rel="prefetch" href="/blog/assets/js/7.acddfbc4.js"><link rel="prefetch" href="/blog/assets/js/8.fb6cd5aa.js"><link rel="prefetch" href="/blog/assets/js/9.9ee19e40.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.f89f62fb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-130b300a><div data-v-130b300a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-130b300a data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>前端杂货铺</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>搬砖仔的博客</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2025
        </a></span></div></div> <div class="hide" data-v-130b300a><header class="navbar" data-v-130b300a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.jpg" alt="前端杂货铺" class="logo"> <span class="site-name">前端杂货铺</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><a href="/blog/handbook/" class="nav-link router-link-active"><i class="undefined"></i>
  笔记
</a></div><div class="nav-item"><a href="/blog/life/" class="nav-link"><i class="undefined"></i>
  随笔
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      ming
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.vuepress.cn/guide" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  power-by
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/qq_45279180?spm=1000.2115.3001.5343" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-130b300a></div> <aside class="sidebar" data-v-130b300a><div class="personal-info-wrapper" data-v-39576ba9 data-v-130b300a><img src="/blog/logo.jpg" alt="author-avatar" class="personal-img" data-v-39576ba9> <!----> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>29</h3> <h6 data-v-39576ba9>文章</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>0</h3> <h6 data-v-39576ba9>标签</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><a href="/blog/handbook/" class="nav-link router-link-active"><i class="undefined"></i>
  笔记
</a></div><div class="nav-item"><a href="/blog/life/" class="nav-link"><i class="undefined"></i>
  随笔
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      ming
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.vuepress.cn/guide" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  power-by
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/qq_45279180?spm=1000.2115.3001.5343" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/blog/handbook/js/从一个简单异步打印时间手写题到thunk和generator" class="sidebar-heading clickable"><span>JavaScript</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/handbook/js/从一个简单异步打印时间手写题到thunk和generator.html" class="sidebar-link">从一个简单异步打印时间手写题到thunk和generator</a></li><li><a href="/blog/handbook/js/防止重复请求.html" class="sidebar-link">防止重复请求</a></li><li><a href="/blog/handbook/js/jsencrypt.html" class="sidebar-link">jsencrypt</a></li><li><a href="/blog/handbook/js/Unicode、Utf-8以及js的字符串与十六进制互转.html" class="sidebar-link">Unicode、Utf-8以及js的字符串与十六进制互转</a></li><li><a href="/blog/handbook/js/使用js创建img加载oss图片跨域的问题.html" class="sidebar-link">使用js创建img加载oss图片跨域的问题</a></li><li><a href="/blog/handbook/js/html-to-image的使用及问题修复(无图、报错).html" class="sidebar-link">html-to-image的使用及问题修复(无图、报错)</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/handbook/TypeScript/TypeScript基础" class="sidebar-heading clickable"><span>TypeScript</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/handbook/TypeScript/TypeScript基础.html" class="sidebar-link">TypeScript基础</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/handbook/Vue/Vue3笔记" class="sidebar-heading clickable"><span>Vue</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/handbook/Vue/Vue3笔记.html" class="sidebar-link">Vue3笔记</a></li><li><a href="/blog/handbook/Vue/vue2工具函数.html" class="sidebar-link">Vue2工具函数源码阅读</a></li><li><a href="/blog/handbook/Vue/关于Vue的渲染函数的事件绑定.html" class="sidebar-link">关于Vue的渲染函数的事件绑定</a></li><li><a href="/blog/handbook/Vue/一个Vue3数字框区间指令及其衍生的一个知识点.html" class="sidebar-link">一个Vue3数字框区间指令及其衍生的一个知识点</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/handbook/React/使用postcss-px-to-viewport-8-plugin将页面转响应式" class="sidebar-heading clickable"><span>React</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/handbook/React/使用postcss-px-to-viewport-8-plugin将页面转响应式.html" class="sidebar-link">使用postcss-px-to-viewport-8-plugin将页面转响应式</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/handbook/Electron/electron镜像地址设置" class="sidebar-heading clickable open"><span>Electron</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/handbook/Electron/electron镜像地址设置.html" class="sidebar-link">electron镜像地址设置</a></li><li><a href="/blog/handbook/Electron/PC端技术总结.html" class="active sidebar-link">electron使用总结</a></li><li><a href="/blog/handbook/Electron/PC端页面开发指南.html" class="sidebar-link">electron开发指南</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/handbook/UI/element-ui-verify的使用" class="sidebar-heading clickable"><span>UI</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/handbook/UI/element-ui-verify的使用.html" class="sidebar-link">element-ui-verify的使用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/handbook/expand/Echarts" class="sidebar-heading clickable"><span>第三方功能库</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/handbook/expand/Echarts.html" class="sidebar-link">Echarts</a></li><li><a href="/blog/handbook/expand/Echarts配置示例.html" class="sidebar-link">Echarts配置示例</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/handbook/envConfig/git使用笔记" class="sidebar-heading clickable"><span>前端环境</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/handbook/envConfig/git使用笔记.html" class="sidebar-link">git使用笔记</a></li><li><a href="/blog/handbook/envConfig/nrm的大致使用.html" class="sidebar-link">nrm的大致使用</a></li><li><a href="/blog/handbook/envConfig/nvm的安装.html" class="sidebar-link">nvm的安装</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/handbook/custom/浏览器拍照" class="sidebar-heading clickable"><span>解决方案</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/handbook/custom/浏览器拍照.html" class="sidebar-link">web浏览器拍照组件</a></li><li><a href="/blog/handbook/custom/剪贴板.html" class="sidebar-link">剪贴板</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>electron的使用</h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><!---->
            
          <!---->
          2025
        </a></span></div></div> <div data-v-130b300a><main class="page" style="padding-right:0;"><section><div class="page-title"><h1 class="title">electron的使用</h1> <div data-v-f875f3fc><i class="iconfont reco-account" data-v-f875f3fc><span data-v-f875f3fc>ming</span></i> <i class="iconfont reco-date" data-v-f875f3fc><span data-v-f875f3fc>2021/7/26</span></i> <!----> <!----></div></div> <div class="theme-reco-content content__default"><p>PC主要用到了<code>electron</code>框架和<code>vue</code>框架。其中electron框架作为主进程用于将项目构建为PC应用，同时可以在渲染进程使用nodeAPI，这部分很重要，后期有几个关键功能就是通过这些API实现的。渲染进程使用的是Vue框架，基本上的页面开发和普通的Web页面比较类似。</p> <h3 id="渲染进程"><a href="#渲染进程" class="header-anchor">#</a> 渲染进程</h3> <p>渲染进程使用的是Vue框架，使用<code>component</code>标签动态切换不同的页面，具体的菜单页使用的是路由来控制的</p> <h4 id="项目结构及页面布局"><a href="#项目结构及页面布局" class="header-anchor">#</a> 项目结构及页面布局</h4> <p>在用户登录后会显示主界面，主界面共有四个模块首页、菜单、统计和设置，统一由<code>MainTabs</code>组件中的<code>component</code>标签的<code>is</code>属性来进行切换，切换的条件为config/static文件中的<code>MainTabs</code>数组成员的name属性，设置is属性为不同的name值就可进行页面的跳转。整体上的页面布局采用了弹性盒子，并通过响应式单位完成了页面的响应式大小，包括对部分组件的样式重写使其具备响应式。在设置页还使用动画模拟出点击效果，增加了用户的体验感。</p> <h4 id="ui框架"><a href="#ui框架" class="header-anchor">#</a> UI框架</h4> <p>该项目中的UI框架有两个，分别为Element-UI和Muse-UI，主要的框架为Muse-UI。因为Muse-UI的弹窗的优先级是高于element-UI的弹窗的优先级的，同时也为了尽量保证风格统一，弹窗这里统一使用的是Muse-UI的弹窗。因为Muse-UI的消息提示不是自带的，而是插件，所以这里还需要下载两个包<code>muse-ui-message</code>和<code>muse-ui-toast</code>。这里需要注意的是因为element-ui的弹窗和muse-ui-toast的使用方式冲突了，所以需要在使用muse-ui-toast的页面导入包然后通过实例的方法来使用，通过挂载到Vue上的方法使用是不行的。</p> <h4 id="其他拓展插件"><a href="#其他拓展插件" class="header-anchor">#</a> 其他拓展插件</h4> <ol><li><code>axios</code>用于数据请求</li> <li><code>lodash</code>js函数库，减少代码编写量提升开发效率</li> <li><code>echarts</code>可视化库，用于实现图表展示</li> <li><code>qs</code>一个增加了一些安全性的查询字符串解析和序列化字符串的库。</li> <li><code>vue-i18n</code>vue国际化插件</li></ol> <p>除上述的插件外还有<code>eslint</code>格式化代码并限制代码格式插件、<code>animate.css</code>vue动画库、<code>typescript</code>ts运行环境等等。因为这些都是运行代码环境所需或者vue脚手架自带的所以这里暂不介绍。</p> <h4 id="路由"><a href="#路由" class="header-anchor">#</a> 路由</h4> <p>因为页面部分有很大一部分内容是菜单页面的子菜单，所以这部分使用了vue-router来进行控制页面跳转，这里着重讲一下菜单部分由路由实现页面切换的步骤。</p> <p>​	1.在router文件夹下的routes.ts文件中的routesList对象中定义子菜单页面，格式如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/UsmAndon&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;UsmAndon&quot;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;../views/UsmModlue/UsmAndon.vue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Andon看板&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>name：就是组件的name值，路径就是文件所处位置，component采用的是动态加载组件的方式，meta中的title就是给用户展示的页面名称。</p> <ol start="2"><li><p>在菜单页面引入路由，并注册相关组件</p> <p>因为是动态加载组件，所以这里的组件注册也是按需加载。</p></li> <li><p>通过接口获取到菜单数据，进行处理并展示后，用户就可以进行点击了。在用户点击代表某一个子菜单的图标后会携带当前选项卡的值触发跳转方法</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">goToChildMenu</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span>options<span class="token punctuation">.</span>routes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routerItme</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>routerItme<span class="token punctuation">.</span>meta <span class="token operator">&amp;&amp;</span> routerItme<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>title <span class="token operator">==</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>
            <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>tabList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> _item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>routerItme<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
          <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>routerItme<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>tabList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>routerItme<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>currentTabName <span class="token operator">=</span> routerItme<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>在方法中会遍历路由列表，将title值一致的组件push到tablist中，因为这里使用的是el-tab组件来实现的，而el-tab-pane处理菜单首页外其余的都是v-for循环生成的,push到tabList中后页面会自动生成一个包含该子菜单的tab页，同时设置currentTabName属性跳转到当前的子菜单页面。</p></li></ol> <h4 id="eventbus"><a href="#eventbus" class="header-anchor">#</a> eventBus</h4> <p>在实现从首页的消息跳转到相应的子菜单页面功能时会有一个问题，因为这是两个兄弟组件，所以实现的方法不多，因为父级组件MainTabs无法更改菜单组件中的 相应的值，所以只能使用vuex或者eventBus,这里因为Vuex使用的是TS语法，为了避免麻烦我使用的是EventBus，跳转方法如下：</p> <ol><li><p>创建一个名为<code>eventBus</code>js文件,然后写入以下语句</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> EventBus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>在<code>NewHome</code>组件中通过事件触发一个方法，在方法中发射一个事件给父组件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">dealMsg</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;toMenu&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div></li> <li><p>在父组件<code>MainTabs</code>中接收这个事件并调用一个方法，在方法内部设置当前的tabIndex的值为代表菜单页的<code>view_module</code>,这个时候页面就会切换为菜单页，然后在<code>MainTabs</code>中导入EventBus文件，并通过eventBus发射一个事件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> EventBus <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../event-bus.js&quot;</span><span class="token punctuation">;</span>


<span class="token function">toMenu</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>tabIndex <span class="token operator">=</span> <span class="token string">&quot;view_module&quot;</span><span class="token punctuation">;</span>
      EventBus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;toChildMenu&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Andon看板&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div></li> <li><p>在菜单页面同样引入EventBus文件,然后在created钩子函数中使用EventBus.$on来接收父组件发射的事件。接收到父组件传过来的值后（这里是自菜单的title值），执行方法跳转到相应子菜单。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> EventBus <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../event-bus.js&quot;</span><span class="token punctuation">;</span>


  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    EventBus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">&quot;toChildMenu&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">goToChildMenu</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div></li></ol> <h4 id="动态加载图片"><a href="#动态加载图片" class="header-anchor">#</a> 动态加载图片</h4> <p>因为每个子菜单的图标是不一样的而且数据是接口拿到的，所以这里的图片是需要动态加载的。但是这里的动态图片不能使用传统的字符串拼接的方式，因为vue不能正确的识别图片类型，所以需要使用require来引入。这里因为我使用的是双重循环生成数据，所以不需要太多处理，直接将img标签写成下面的格式即可：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>require(<span class="token punctuation">'</span>../assets/images/<span class="token punctuation">'</span> + _item.iconName)<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><h4 id="登出"><a href="#登出" class="header-anchor">#</a> 登出</h4> <p>在用户点击登出后会弹出提示信息，如果用户点击确定就会通过渲染进程发送一个logout的事件，在主进程监听到后会隐藏当前主窗口并显示登录窗口。这里需要注意的，如果登录的时候不清除登录页面的状态，登出的时候会显示之前的状态。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//渲染进程</span>
Message<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$i18n<span class="token punctuation">.</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token string">&quot;message.message_mine_quitout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$i18n<span class="token punctuation">.</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token string">&quot;base.prompt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;warning&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">&quot;cloud_upload&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">okLabel</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$i18n<span class="token punctuation">.</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token string">&quot;base.confirm&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token literal-property property">cancelLabel</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$i18n<span class="token punctuation">.</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token string">&quot;base.cancel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> result <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 关闭当前窗口</span>
          ipcRenderer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;logout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
  <span class="token comment">//主进程</span>
  ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;logout&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    loginWin<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">&lt;</span>BrowserWindow<span class="token operator">&gt;</span>win<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="国际化格式"><a href="#国际化格式" class="header-anchor">#</a> 国际化格式</h4> <p>因为会有英文字数大大超过中文字数的现象出现，所以为了避免因为字数过多影响布局，在设置页统一设置了单行文字、溢出隐藏以及tooltip提示文字</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token property">white-space</span><span class="token punctuation">:</span> nowrap<span class="token punctuation">;</span>
<span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
<span class="token property">text-overflow</span><span class="token punctuation">:</span> ellipsis<span class="token punctuation">;</span>

</code></pre></div><h3 id="主进程"><a href="#主进程" class="header-anchor">#</a> 主进程</h3> <p>electron框架分为主进程和渲染进程，主进程用于创建<a href="https://github.com/electron/electron/blob/master/docs/api/browser-window.md" target="_blank" rel="noopener noreferrer">BrowserWindow<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>实例以及各种应用程序事件，可以说主进程负责整个程序的运行。</p> <h4 id="主窗口"><a href="#主窗口" class="header-anchor">#</a> 主窗口</h4> <p>使用electron框架自带的BrowserWindow构造函数来创建一个主窗口，这里给了一些配置项，例如窗口大小，关闭自带的顶部菜单栏等选项。这里需要一个变量去接收这个窗口实例以供后期使用。</p> <p>主窗口会监听最小化、退出应用以及登录、登出四个事件，前两个事件顾名思义不用赘述，重点是这个登录和登出的事件。在用户登录成功时会触发登录事件，这时会将登录的子窗口关闭，显示应用的主窗口。当登出事件触发时则正好相反，主窗口隐藏，登录窗口显示。</p> <h4 id="子窗口-登录窗口"><a href="#子窗口-登录窗口" class="header-anchor">#</a> 子窗口(登录窗口)</h4> <p>子窗口的创建方式和主窗口一致，但是需要设置parent属性来指明该窗口所属的父级窗口。</p> <p>子窗口监听<code>hide</code>事件，这个是当子窗口隐藏时会触发该事件，在该事件中我们让主窗口进行显示。</p> <h4 id="检测网络"><a href="#检测网络" class="header-anchor">#</a> 检测网络</h4> <p>本项目中检测网络使用的是cmd中的ping命令来实现的，操作方式如下</p> <ol><li>在主进程中开放node的接口。</li> <li>在渲染进程中需要使用检测网络功能的页面通过导入拿到node中的<code>child_process</code>模块</li> <li>导入<code>iconv-lite</code>插件，这个是用于将cmd的内容进行转码，拿到<code>iconv-lite</code>实例后设置实例的<code>skipDecodeWarning</code>属性为<code>true</code>跳过解码警告</li> <li>设置解码方式和二进制编码</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> encodings <span class="token operator">=</span> <span class="token string">&quot;cp936&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> binaryEncoding <span class="token operator">=</span> <span class="token string">&quot;binary&quot;</span><span class="token punctuation">;</span>
</code></pre></div><ol start="5"><li>使用<code>child_process</code>中的<code>exec</code>方法来进行ping命令，并设置编码为之前设置的二进制编码</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> child <span class="token operator">=</span> child_process<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">&quot;ping &quot;</span> <span class="token operator">+</span> ip<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">encoding</span><span class="token operator">:</span> binaryEncoding<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><ol start="6"><li>分别监听<code>child</code>实例中的<code>stdout</code>和<code>stderr</code>的值</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>child<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        item<span class="token punctuation">.</span>checked <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iconv<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> encodings<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
child<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        item<span class="token punctuation">.</span>checked <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;error 输出:&quot;</span><span class="token punctuation">,</span> iconv<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> encodings<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="7"><li>这个时候我们就可以看到控制台打印出了cmd运行命令的过程输出语句，这个时候只要对结果进行处理判断就可以判断该网络是否可用。</li></ol> <h4 id="更新应用"><a href="#更新应用" class="header-anchor">#</a> 更新应用</h4> <p>本项目实现应用更新是使用<code>electron-updater</code>来实现的，因为本应用有自动更新和手动更新，这里为表达详细暂以手动更新做示例。步骤如下：</p> <ol><li>在<code>vue.config.js</code>文件中的<code>electronBuilder</code>对象中添加一个<code>builderOptions</code>编译选项对象，配置如下：</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>      <span class="token literal-property property">builderOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">nsis</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">oneClick</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token literal-property property">perMachine</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">allowElevation</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">allowToChangeInstallationDirectory</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">createDesktopShortcut</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">runAfterFinish</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">installerIcon</span><span class="token operator">:</span> <span class="token string">&quot;./build/favicon.ico&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">uninstallerIcon</span><span class="token operator">:</span> <span class="token string">&quot;./build/favicon.ico&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">publish</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
          <span class="token literal-property property">provider</span><span class="token operator">:</span> <span class="token string">&quot;generic&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;http://192.168.37.112:8888/uma-unimax-web/ext/download/&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">mac</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">&quot;./build/aaaaa.ico&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">win</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">&quot;./build/aaaaa.ico&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">linux</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">&quot;./build/aaaaa.ico&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
</code></pre></div><p>这里解释一下各个参数的含义，其中<code>publish</code>是最为关键的，该配置会在打包项目时生成一个<code>latest.yml</code>文件，改文件是实现更新的关键。publish中的url一定要是服务器的地址同时还需要和主进程中的配置一直，这个会在后面说到。<code>nsis</code>是应用相关的配置，这里随便说两个，例如<code>allowToChangeInstallationDirectory</code>是否允许用户自定义安装目录，<code>createDesktopShortcut</code>是否生成桌面快捷方式，<code>installerIcon</code>安装包的图标。。。最后就是mac、win、linux中的icon就是各个环境下的图标样式。</p> <ol start="2"><li><p>配置完毕后执行打包命令，这个时候会生成dist_electron文件夹，目录结构如下:然后将之前提过的<code>latest.yml</code>文件和应用安装包<code>unimax-pc Setup 0.0.1.exe</code>方法放到服务器的指定地址下面，这个地址后面会说。这个安装包后面的0.0.1就是应用的版本号。latest.yml文件之所以重要是因为它记录了应用需要更新的相关信息例如版本号、更新地址等。</p></li> <li><p>在主进程中拿到<code>electron-updater</code>中的<code>autoUpdater</code>,然后定义一个方法，在方法中设置更新的网址</p> <blockquote><p>autoUpdater.setFeedURL(</p> <p>&quot;http://192.168.40.156:8888/uma-unimax-web/ext/download&quot;</p> <p>);</p></blockquote> <p>其中ip地址就是之前在<code>vue.config.js</code>文件中设置的ip地址，这里有域名也可以用域名会更方便。后面的路径就是专门用于存放之前说过的两个文件的地方。</p></li> <li><p>定义一个方法，然后在方法内通过<code>autoUpdater</code>监听下列一系列事件</p></li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">/</span>更新错误
    autoUpdater<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">sendUpdateMessage</span><span class="token punctuation">(</span>returnData<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//检查中</span>
    autoUpdater<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;checking-for-update&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">sendUpdateMessage</span><span class="token punctuation">(</span>returnData<span class="token punctuation">.</span>checking<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//发现新版本</span>
    <span class="token comment">//当发现一个可用更新的时候，更新包下载会自动开始</span>
    autoUpdater<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;update-available&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">sendUpdateMessage</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'___'</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>returnData<span class="token punctuation">.</span>updateAva<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//当前版本为最新版本</span>
    autoUpdater<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;update-not-available&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sendUpdateMessage</span><span class="token punctuation">(</span>returnData<span class="token punctuation">.</span>updateNotAva<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 更新下载进度事件</span>
    autoUpdater<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;download-progress&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">progressObj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">sendUpdateMessage</span><span class="token punctuation">(</span><span class="token string">&quot;正在下载&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>win<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        win<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;downloadProgress&quot;</span><span class="token punctuation">,</span> progressObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    autoUpdater<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;update-downloaded&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>
      <span class="token parameter">event<span class="token punctuation">,</span>
      releaseNotes<span class="token punctuation">,</span>
      releaseName<span class="token punctuation">,</span>
      releaseDate<span class="token punctuation">,</span>
      updateUrl<span class="token punctuation">,</span>
      quitAndUpdate</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>

      <span class="token function">sendUpdateMessage</span><span class="token punctuation">(</span><span class="token string">&quot;更新完毕&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 退出并安装</span>
      autoUpdater<span class="token punctuation">.</span><span class="token function">quitAndInstall</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>各个监听事件的作用都有注释这里就不再解释了。</p> <ol start="5"><li><p>在主进程设置了更新事件后还需要定义一个方法去发送消息给渲染进程</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token comment">// 通过main进程发送事件给renderer进程，提示更新信息</span>
  <span class="token keyword">function</span> <span class="token function">sendUpdateMessage</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>win<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      win<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>最后再监听自动更新事件,然后再执行第四步中的方法</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token comment">// 检查更新</span>
  ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;checkForUpdate&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;执行自动更新检查!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    autoUpdater<span class="token punctuation">.</span><span class="token function">checkForUpdates</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>在渲染进程中获取<code>package.json</code>文件中的版本信息，然后在通过接口获取到服务器所存放的最新安装包的版本进行比对，如果不是最新版则提示用户执行更新。</p></li> <li><p>渲染进程首先通过<code>send</code>方法去触发检查更新</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> ipcRenderer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;checkForUpdate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>在事件触发后，<code>autoUpdater</code>会自动触发第四步中的一系列监听，首先会开启<code>checking-for-update</code>事件，确认需要更新后会执行<code>update-available</code>事件开始下载，下载时会触发<code>download-progress</code>事件，我们可以在该事件的回调中拿到下载进度等一系列参数。在下载完毕后会执行<code>update-downloaded</code>事件，然后退出当前应用并自动安装新版本。下载的最新版本会存放在<code>C:\Users\zym\AppData\Local\unimax-pc-updater</code>路径下。 .</p></li></ol></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2022/7/30 23:22:33</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/blog/handbook/Electron/electron镜像地址设置.html" class="prev">
            electron镜像地址设置
          </a></span> <span class="next"><a href="/blog/handbook/Electron/PC端页面开发指南.html">
            electron开发指南
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:0;" data-v-cb1513f6></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/blog/assets/js/app.c9971401.js" defer></script><script src="/blog/assets/js/3.622c1259.js" defer></script><script src="/blog/assets/js/1.525466ec.js" defer></script><script src="/blog/assets/js/11.ac1e60a5.js" defer></script>
  </body>
</html>
